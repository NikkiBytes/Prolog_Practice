#!/usr/bin/perl
use strict;

print "% Generated by pldoc2plsq command in blipkit/bin\n";
print ":- discontiguous relation/2.\n";
print ":- discontiguous attribute/4.\n";
print ":- discontiguous unique/3.\n";
print "\n";

while (<>) {
    if (/^%%\s*(\w+)\((.*)\)/) {
        my ($p,$argstr) = ($1,$2);
        my $is_datalog = 1;
        my @types = ();
        my @args = split(/,\s*/,$argstr);
        @args = map {
            s/^\W//g;
            my $type = 'string';
            if (/:(\w+)/) {
                $type = $1;
                if ($type eq 'list') {
                    $is_datalog = 0;
                }
            }
            s/\W.*//;
            push(@types,$type);
            $_;
        } @args;

        next unless $is_datalog;

        my $arity = scalar(@args);
        print "\n";
        print "relation($p,$arity).\n";
        for (my $i=1;$i<=$arity;$i++) {
            printf "attribute(%d,%s,'%s',%s).\n",$i,$p,$args[$i-1],$types[$i-1] || 'string';
        }
    }
}
